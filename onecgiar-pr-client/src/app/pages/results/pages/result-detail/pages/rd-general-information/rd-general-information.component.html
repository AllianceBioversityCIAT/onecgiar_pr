<app-rd-annual-updating *ngIf="this.generalInfoBody.is_replicated" [generalInfoBody]="this.generalInfoBody"></app-rd-annual-updating>
<div class="detail_container">
  <app-alert-status
    *ngIf="this.api.dataControlSE.isKnowledgeProduct"
    description="In case some of the metadata fields are incorrect, please get in touch with the library staff of your Center to update them in the repository. Before the end of the reporting period, metadata will be automatically refreshed on this page.">
  </app-alert-status>

  <app-pr-input
    fieldRef="[general-info]-title"
    type="text"
    [readOnly]="this.dataControlSE.isKnowledgeProduct"
    [(ngModel)]="this.generalInfoBody.result_name"
    [maxWords]="30">
  </app-pr-input>

  <app-pr-textarea
    fieldRef="[general-info]-description"
    [readOnly]="this.dataControlSE.isKnowledgeProduct"
    [(ngModel)]="this.generalInfoBody.result_description"
    [maxWords]="150"></app-pr-textarea>

  <app-lead-contact-person-field [body]="this.generalInfoBody"></app-lead-contact-person-field>

  <h1 class="pr_label">Impact Area scores:</h1>
  <app-alert-status [description]="impactAreaScoresInfo()"> </app-alert-status>

  <!------- [1] ------->
  <div class="block_container">
    <app-alert-status [description]="genderInformation()"> </app-alert-status>
    <div class="radio_grid">
      <app-pr-radio-button
        [options]="this.scoreSE.genderTagScoreList"
        optionLabel="full_name"
        optionValue="id"
        fieldRef="[general-info]-gender_tag_id"
        [(ngModel)]="this.generalInfoBody.gender_tag_id">
      </app-pr-radio-button>
      <div id="gender_tag_alert" [hidden]="this.generalInfoBody.gender_tag_id != 3"></div>
    </div>
    @if (this.generalInfoBody.gender_tag_id == 3) {
      <app-pr-radio-button
        [options]="this.getImpactAreasScoresComponents.genderTagScoreList()"
        optionLabel="name"
        optionValue="id"
        fieldRef="[general-info]-gender_impact_area_id"
        [(ngModel)]="this.generalInfoBody.gender_impact_area_id">
      </app-pr-radio-button>
    }
  </div>

  <!------- [2] ------->
  <div class="block_container">
    <app-alert-status [description]="climateInformation()"> </app-alert-status>
    <div class="radio_grid" id="climate_change_tag">
      <app-pr-radio-button
        [options]="this.scoreSE.genderTagScoreList"
        optionLabel="full_name"
        optionValue="id"
        fieldRef="[general-info]-climate_change_tag_id"
        [(ngModel)]="this.generalInfoBody.climate_change_tag_id">
      </app-pr-radio-button>
      <div id="climate_change_tag_alert" [hidden]="this.generalInfoBody.climate_change_tag_id != 3"></div>
    </div>
    @if (this.generalInfoBody.climate_change_tag_id == 3) {
      <app-pr-radio-button
        [options]="this.getImpactAreasScoresComponents.climateTagScoreList()"
        optionLabel="name"
        optionValue="id"
        fieldRef="[general-info]-climate_impact_area_id"
        [(ngModel)]="this.generalInfoBody.climate_impact_area_id">
      </app-pr-radio-button>
    }
  </div>

  <!------- [3] ------->
  <div class="block_container">
    <app-alert-status [description]="nutritionInformation()"> </app-alert-status>
    <div class="radio_grid">
      <app-pr-radio-button
        [options]="this.scoreSE.genderTagScoreList"
        optionLabel="full_name"
        optionValue="id"
        fieldRef="[general-info]-nutrition_tag_level_id"
        [(ngModel)]="this.generalInfoBody.nutrition_tag_level_id">
      </app-pr-radio-button>
      <div id="nutrition_tag_alert" [hidden]="this.generalInfoBody.nutrition_tag_level_id != 3"></div>
    </div>
    @if (this.generalInfoBody.nutrition_tag_level_id == 3) {
      <app-pr-radio-button
        [options]="this.getImpactAreasScoresComponents.nutritionTagScoreList()"
        optionLabel="name"
        optionValue="id"
        fieldRef="[general-info]-nutrition_impact_area_id"
        [(ngModel)]="this.generalInfoBody.nutrition_impact_area_id">
      </app-pr-radio-button>
    }
  </div>

  <!------- [4] ------->
  <div class="block_container">
    <app-alert-status [description]="environmentInformation()"> </app-alert-status>
    <div class="radio_grid">
      <app-pr-radio-button
        [options]="this.scoreSE.genderTagScoreList"
        optionLabel="full_name"
        optionValue="id"
        fieldRef="[general-info]-environmental_biodiversity_tag_level_id"
        [(ngModel)]="this.generalInfoBody.environmental_biodiversity_tag_level_id">
      </app-pr-radio-button>
      <div id="environment_tag_alert" [hidden]="this.generalInfoBody.environmental_biodiversity_tag_level_id != 3"></div>
    </div>
    @if (this.generalInfoBody.environmental_biodiversity_tag_level_id == 3) {
      <app-pr-radio-button
        [options]="this.getImpactAreasScoresComponents.environmentalBiodiversityTagScoreList()"
        optionLabel="name"
        optionValue="id"
        fieldRef="[general-info]-environmental_biodiversity_impact_area_id"
        [(ngModel)]="this.generalInfoBody.environmental_biodiversity_impact_area_id">
      </app-pr-radio-button>
    }
  </div>

  <!------- [5] ------->
  <div class="block_container">
    <app-alert-status [description]="povertyInformation()"> </app-alert-status>
    <div class="radio_grid">
      <app-pr-radio-button
        [options]="this.scoreSE.genderTagScoreList"
        optionLabel="full_name"
        optionValue="id"
        fieldRef="[general-info]-poverty_tag_level_id"
        [(ngModel)]="this.generalInfoBody.poverty_tag_level_id">
      </app-pr-radio-button>
      <div id="poverty_tag_alert" [hidden]="this.generalInfoBody.poverty_tag_level_id != 3"></div>
    </div>
    @if (this.generalInfoBody.poverty_tag_level_id == 3) {
      <app-pr-radio-button
        [options]="this.getImpactAreasScoresComponents.povertyTagScoreList()"
        optionLabel="name"
        optionValue="id"
        fieldRef="[general-info]-poverty_impact_area_id"
        [(ngModel)]="this.generalInfoBody.poverty_impact_area_id">
      </app-pr-radio-button>
    }
  </div>

  <app-pr-yes-or-not
    fieldRef="[general-info]-is_krs"
    label="yes"
    [(ngModel)]="this.generalInfoBody.is_krs"
    (ngModelChange)="onChangeKrs()"></app-pr-yes-or-not>

  <app-pr-input
    *ngIf="this.generalInfoBody.is_krs"
    placeholder="e.g. https://www.cgiar.org/example"
    description="Link to Key Result Story. It is also possible to select “no” and then later update this to “yes” if the result is later selected as a key result story."
    type="text"
    [required]="false"
    [(ngModel)]="this.generalInfoBody.krs_url">
  </app-pr-input>

  <app-save-button
    class="position_sticky"
    (clickSave)="onSaveSection()"
    [editable]="
      this.api.dataControlSE.currentResult?.result_type_id == 7
        ? this.api.rolesSE.access.canDdit && !this.dataControlSE?.currentResult?.status
        : false
    "
    [disabled]="!this.generalInfoBody.result_name"></app-save-button>
  <app-sync-button (clickSave)="onSyncSection()"></app-sync-button>
</div>

<app-change-result-type-modal [body]="this.generalInfoBody"></app-change-result-type-modal>
