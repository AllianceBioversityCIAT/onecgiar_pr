<div class="container" *ngIf="activeTab">
  <div class="flex-no-wrap" *ngIf="activeTab?.planned_result !== null && showMultipleWPsContent">
    <div style="max-width: 250px" *ngIf="resultLevelId === 1 ? !activeTab?.planned_result : true">
      <app-pr-select
        [options]="this.tocResultListFiltered()"
        label="Level"
        [editable]="editable"
        optionLabel="name"
        optionValue="toc_level_id"
        placeholder="Select outcome level"
        [(ngModel)]="activeTab.toc_level_id"
        (ngModelChange)="indicatorView = false; this.activeTabSignal.set(activeTab)">
      </app-pr-select>
    </div>

    @if (this.secondFieldLabel()) {
      @switch (activeTab.toc_level_id) {
        @case (3) {
          <app-pr-select
            [options]="eoiList()"
            [label]="this.secondFieldLabel()"
            [editable]="editable"
            [disabled]="(resultLevelId === 1 && false) || !editable"
            optionLabel="title"
            optionValue="toc_result_id"
            placeholder="Select outcome"
            [(ngModel)]="activeTab.toc_result_id"
            (ngModelChange)="getIndicatorsList()">
          </app-pr-select>
        }
        @case (2) {
          <app-pr-select
            [options]="outcomeList()"
            [label]="this.secondFieldLabel()"
            [editable]="editable"
            [disabled]="(resultLevelId === 1 && false) || !editable"
            optionLabel="extraInformation"
            [extraInformation]="true"
            optionValue="toc_result_id"
            placeholder="Select outcome"
            [(ngModel)]="activeTab.toc_result_id"
            (ngModelChange)="getIndicatorsList()">
          </app-pr-select>
        }
        @case (1) {
          <app-pr-select
            [options]="outputList()"
            [label]="this.secondFieldLabel()"
            optionLabel="extraInformation"
            optionValue="toc_result_id"
            [disabled]="!editable"
            [editable]="editable"
            placeholder="Select output"
            [(ngModel)]="activeTab.toc_result_id"
            [extraInformation]="true"
            (ngModelChange)="getIndicatorsList()">
          </app-pr-select>
        }
      }
    }
  </div>
  @if (showIndicators()) {
    <app-pr-select
      [options]="this.indicatorsList()"
      label="Indicator"
      [editable]="editable"
      optionLabel="indicator_description"
      optionValue="related_node_id"
      placeholder="Select outcome level"
      [(ngModel)]="activeTab.indicators[0].related_node_id"
      (ngModelChange)="mapTocResultsIndicatorId()">
    </app-pr-select>
    <app-pr-input placeholder="Enter target" label="Target" type="number" [(ngModel)]="activeTab.indicators[0].targets[0].contributing_indicator">
    </app-pr-input>
  }
  <hr class="divider-20" />

  <app-pr-textarea
    [label]="dynamicProgressLabel()"
    [required]="false"
    placeholder="Enter text"
    [rows]="3"
    [(ngModel)]="activeTab.toc_progressive_narrative"
    [maxWords]="150">
  </app-pr-textarea>
</div>

<app-mapped-results-modal [activeTab]="activeTab" [outputList]="outputList" [resultLevelId]="resultLevelId"></app-mapped-results-modal>
