<div class="filters">
  <div class="filters_items_container_left">
    <!-- Search -->
    <p-iconfield>
      <p-inputicon styleClass="pi pi-search" />
      <input type="text" pInputText placeholder="Find result..." [(ngModel)]="this.resultsListFilterSE.text_to_search" [style]="{ width: '350px' }" />
    </p-iconfield>
    <!-- apply filters button -->
    <p-overlaybadge value="" [badgeDisabled]="filtersCount() === 0">
      <app-pr-button (click)="openFiltersDrawer()" [text]="filtersCountText()" [verticalMargin]="-6" icon="filter_alt" [reverse]="true" />
    </p-overlaybadge>
    <!-- celar fitlers -->
    <app-pr-button (click)="this.clearAllNewFilters()" text="Clear Filters" [verticalMargin]="0" colorType="secondary" />
  </div>

  <p-button label="Download" variant="outlined" icon="pi pi-download" (click)="onDownLoadTableAsExcel()" [loading]="this.gettingReport()" />
</div>

<!-- Filter Chips Bar -->
@if (filterChipGroups().length > 0) {
  <div class="filter-chips-container">
    <span class="filter-chips-main-label">Results filtered by</span>
    <div class="filter-chips-groups-wrapper">
      @for (group of filterChipGroups(); track group.category) {
        <div class="filter-chip-group">
          <span class="filter-chip-category-label">{{ group.category }}</span>
          <span class="filter-chip-arrow">â†’</span>
          <div class="filter-chips-list">
            @for (chip of group.chips; track chip.label) {
              <p-chip [label]="chip.label" [removable]="true" (onRemove)="removeFilter(chip)" styleClass="filter-chip" />
            }
          </div>
        </div>
      }
    </div>
  </div>
}

<!-- Custom Drawer -->
<div class="custom-drawer-container" [class.visible]="visible()" [style.top.px]="navbarHeight()">
  <div class="custom-drawer" [class.open]="visible()">
    <div class="drawer-content">
      <div class="drawer-header">
        <h3 class="drawer-title">Table Filters</h3>
        <button class="close-button" (click)="cancelFilters()" aria-label="Close">
          <i class="pi pi-times"></i>
        </button>
      </div>

      <p class="drawer-description">Filter your table data by applying custom criteria.</p>

      <div class="filters_items_container_drawer" style="flex-direction: column; margin: 0; gap: 20px">
        <div>
          <app-pr-field-header
            label="Portfolio"
            labelDescInlineStyles="margin-bottom: 5px; margin-top: 0; color: var(--pr-color-primary-300)"
            [required]="false"></app-pr-field-header>

          <p-multiselect
            [filter]="false"
            [showHeader]="false"
            [options]="this.clarisaPortfolios()"
            [(ngModel)]="tempSelectedClarisaPortfolios"
            (onChange)="onSelectPortfolios()"
            optionLabel="name"
            placeholder="Select portfolio"
            [maxSelectedLabels]="1"
            [style]="{ width: '100%' }" />
        </div>
        <div>
          <app-pr-field-header
            label="Phase"
            labelDescInlineStyles="margin-bottom: 5px; margin-top: 0; color: var(--pr-color-primary-300)"
            [required]="false"></app-pr-field-header>
          <p-multiselect
            [filter]="false"
            [showHeader]="false"
            [options]="filteredPhasesOptions()"
            [(ngModel)]="tempSelectedPhases"
            (onChange)="onSelectPhases()"
            optionLabel="name"
            placeholder="Select phase"
            [maxSelectedLabels]="1"
            [style]="{ width: '100%' }" />
        </div>

        <div>
          <app-pr-field-header
            label="Submitter(s)"
            labelDescInlineStyles="margin-bottom: 5px; margin-top: 0; color: var(--pr-color-primary-300)"
            [required]="false"></app-pr-field-header>

          <p-multiselect
            [filter]="this.resultsListFilterSE.submittersOptionsAdmin().length > 0"
            [showHeader]="false"
            [options]="this.resultsListFilterSE.submittersOptionsAdmin()"
            [(ngModel)]="tempSelectedSubmittersAdmin"
            placeholder="Select submitter(s)"
            [maxSelectedLabels]="1"
            optionLabel="displayName"
            [selectedItemsLabel]="'{0} items selected'"
            [style]="{ width: '100%' }"
            panelStyleClass="submitter-multiselect-panel">
          </p-multiselect>
        </div>
        <div>
          <app-pr-field-header
            label="Indicator category(ies)"
            labelDescInlineStyles="margin-bottom: 5px; margin-top: 0; color: var(--pr-color-primary-300)"
            [required]="false"></app-pr-field-header>

          <p-multiselect
            [filter]="false"
            [showHeader]="false"
            [options]="this.resultsListFilterSE.filters.resultLevel | reverse"
            [(ngModel)]="tempSelectedIndicatorCategories"
            optionLabel="name"
            placeholder="Select indicator category(ies)"
            [maxSelectedLabels]="1"
            [group]="true"
            optionGroupChildren="options"
            [style]="{ width: '100%' }">
            <ng-template let-group #group>
              <div class="flex items-center">
                <span>{{ group.name }}</span>
              </div>
            </ng-template>
          </p-multiselect>
        </div>

        <div>
          <app-pr-field-header
            label="Status"
            labelDescInlineStyles="margin-bottom: 5px; margin-top: 0; color: var(--pr-color-primary-300)"
            [required]="false"></app-pr-field-header>

          <p-multiselect
            [filter]="false"
            [showHeader]="false"
            [options]="this.resultsListFilterSE.statusOptions()"
            [(ngModel)]="tempSelectedStatus"
            optionLabel="name"
            placeholder="Select status"
            [maxSelectedLabels]="3"
            [style]="{ width: '100%' }" />
        </div>
      </div>
    </div>

    <!-- Footer buttons -->
    <div class="drawer-footer">
      <p-button label="Cancel" variant="outlined" [style]="{ width: '100%' }" (click)="cancelFilters()" />
      <p-button label="Apply filters" [style]="{ width: '100%' }" (click)="applyFilters()" />
    </div>
  </div>
</div>
