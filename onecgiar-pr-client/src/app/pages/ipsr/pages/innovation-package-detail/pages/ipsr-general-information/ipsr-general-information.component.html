<app-ipsr-annual-updating *ngIf="this.ipsrGeneralInformationBody.is_replicated" [ipsrGeneralInfoBody]="this.ipsrGeneralInformationBody"
></app-ipsr-annual-updating>

<app-pr-input placeholder="Provide input here..." label="Reporting year" type="text" [required]="false"
    [readOnly]="true" [(ngModel)]="this.ipsrGeneralInformationBody.reported_year_id">
</app-pr-input>

<app-pr-textarea placeholder="Provide input here..."
    description="Title is autogenerated as per the selected core innovation and its geoscope but is editable."
    label="Title" type="text" [(ngModel)]="this.ipsrGeneralInformationBody.title" [maxWords]="30" [rows]="2" [autogenerate]="true">
</app-pr-textarea>

<app-pr-textarea placeholder="Provide input here..." label="Description" type="text" [required]="true" [maxWords]="150"
    [(ngModel)]="this.ipsrGeneralInformationBody.description">
</app-pr-textarea>

<div class="lead-contact-container">
  <app-pr-input 
    placeholder="Search for a person (min 4 characters)" 
    label="Lead contact person" 
    type="text" 
    [description]="leadContactPersonTextInfo()"
    [required]="false"
    [(ngModel)]="searchQuery"
    (input)="onSearchInput($event)"
    (blur)="onContactBlur()"
    [class.invalid-contact]="!hasValidContact"
    autocomplete="off">
  </app-pr-input>

  <div class="contact-error-message" *ngIf="showContactError">
    <i class="warning-icon">⚠️</i>
    The contact person entered was not found in the directory. Please select from the search results or leave empty.
  </div>
</div>

<div class="search-results-container" *ngIf="(searchResults.length > 0 && showResults) || isSearching">
  <div class="search-results" *ngIf="searchResults.length > 0 && showResults">
    <div 
      class="search-result-item" 
      *ngFor="let user of searchResults"
      (click)="selectUser(user)">
      <div class="user-name">{{ user.displayName }}</div>
      <div class="user-details">{{ user.mail }} - {{ user.title }}</div>
    </div>
  </div>
  
  <div class="search-loading" *ngIf="isSearching">
    Searching...
  </div>

  <div class="no-results" *ngIf="searchResults.length === 0 && !isSearching && showResults">
    No users found matching "{{ searchQuery }}". Please try a different search term.
  </div>
</div>

<div class="block_container">
    <app-alert-status [description]="genderInformation()"></app-alert-status>

    <div class="radio_grid">
        <app-pr-radio-button [options]="this.scoreSE.genderTagScoreList" optionLabel="full_name" optionValue="id"
            label="Gender equality tag" [(ngModel)]="this.ipsrGeneralInformationBody.gender_tag_level_id">
        </app-pr-radio-button>

        <div *ngIf="this.ipsrGeneralInformationBody.gender_tag_level_id == 3">
            <app-alert-status
                description="As a score of 2 has been selected, you are required to provide evidence of the Gender equality tag.">
            </app-alert-status>
        </div>
    </div>

    <div *ngIf="this.ipsrGeneralInformationBody.gender_tag_level_id != null">
        <app-pr-input label="Evidence" [required]="this.ipsrGeneralInformationBody.gender_tag_level_id == 3"
            placeholder="Link" [(ngModel)]="this.ipsrGeneralInformationBody.evidence_gender_tag">
        </app-pr-input>
    </div>
</div>

<div class="block_container">
    <app-alert-status [description]="climateInformation()"></app-alert-status>

    <div class="radio_grid">
        <app-pr-radio-button [(ngModel)]="this.ipsrGeneralInformationBody.climate_change_tag_level_id"
            [options]="this.scoreSE.genderTagScoreList" optionLabel="full_name" optionValue="id"
            label="Climate change tag">
        </app-pr-radio-button>

        <div *ngIf="this.ipsrGeneralInformationBody.climate_change_tag_level_id == 3">
            <app-alert-status
                description="As a score of 2 has been selected, you are required to provide evidence of the climate change tag.">
            </app-alert-status>
        </div>
    </div>

    <div *ngIf="this.ipsrGeneralInformationBody.climate_change_tag_level_id != null">
        <app-pr-input label="Evidence" [required]="this.ipsrGeneralInformationBody.climate_change_tag_level_id == 3"
            placeholder="Link" [(ngModel)]="this.ipsrGeneralInformationBody.evidence_climate_tag">
        </app-pr-input>
    </div>
</div>

<div class="block_container">
    <app-alert-status [description]="nutritionInformation()"></app-alert-status>

    <div class="radio_grid">
        <app-pr-radio-button [(ngModel)]="this.ipsrGeneralInformationBody.nutrition_tag_level_id"
            [options]="this.scoreSE.genderTagScoreList" optionLabel="full_name" optionValue="id" label="Nutrition, health and food security tag">
        </app-pr-radio-button>

        <div *ngIf="this.ipsrGeneralInformationBody.nutrition_tag_level_id == 3">
            <app-alert-status
                description="As a score of 2 has been selected, you are required to provide evidence of the Nutrition, health and food security tag.">
            </app-alert-status>
        </div>
    </div>

    <div *ngIf="this.ipsrGeneralInformationBody.nutrition_tag_level_id != null">
        <app-pr-input label="Evidence" [required]="this.ipsrGeneralInformationBody.nutrition_tag_level_id == 3"
            placeholder="Link" [(ngModel)]="this.ipsrGeneralInformationBody.evidence_nutrition_tag">
        </app-pr-input>
    </div>
</div>

<div class="block_container">
    <app-alert-status [description]="environmentInformation()"></app-alert-status>

    <div class="radio_grid">
        <app-pr-radio-button [(ngModel)]="this.ipsrGeneralInformationBody.environmental_biodiversity_tag_level_id"
            [options]="this.scoreSE.genderTagScoreList" optionLabel="full_name" optionValue="id"
            label="Environmental health and biodiversity tag">
        </app-pr-radio-button>

        <div *ngIf="this.ipsrGeneralInformationBody.environmental_biodiversity_tag_level_id == 3">
            <app-alert-status
                description="As a score of 2 has been selected, you are required to provide evidence of the Environmental health and biodiversity tag.">
            </app-alert-status>
        </div>
    </div>

    <div *ngIf="this.ipsrGeneralInformationBody.environmental_biodiversity_tag_level_id != null">
        <app-pr-input label="Evidence"
            [required]="this.ipsrGeneralInformationBody.environmental_biodiversity_tag_level_id == 3" placeholder="Link"
            [(ngModel)]="this.ipsrGeneralInformationBody.evidence_environment_tag">
        </app-pr-input>
    </div>
</div>

<div class="block_container">
    <app-alert-status [description]="povertyInformation()">
    </app-alert-status>

    <div class="radio_grid">
        <app-pr-radio-button [(ngModel)]="this.ipsrGeneralInformationBody.poverty_tag_level_id"
            [options]="this.scoreSE.genderTagScoreList" optionLabel="full_name" optionValue="id" label="Poverty reduction, livelihoods and jobs tag">
        </app-pr-radio-button>

        <div *ngIf="this.ipsrGeneralInformationBody.poverty_tag_level_id == 3">
            <app-alert-status
                description="As a score of 2 has been selected, you are required to provide evidence of the Poverty reduction, livelihoods and jobs tag.">
            </app-alert-status>
        </div>
    </div>

    <div *ngIf="this.ipsrGeneralInformationBody.poverty_tag_level_id != null">
        <app-pr-input label="Evidence" [required]="this.ipsrGeneralInformationBody.poverty_tag_level_id == 3"
            placeholder="Link" [(ngModel)]="this.ipsrGeneralInformationBody.evidence_poverty_tag">
        </app-pr-input>
    </div>
</div>

<app-pr-yes-or-not label="Is this result featured in a Key Result Story for the reporting year?"
    (ngModelChange)="onChangeKrs()" [(ngModel)]="this.ipsrGeneralInformationBody.is_krs"></app-pr-yes-or-not>
<app-pr-input *ngIf="this.ipsrGeneralInformationBody.is_krs" placeholder="e.g. https://www.cgiar.org/example"
    type="text" [required]="false" [(ngModel)]="this.ipsrGeneralInformationBody.krs_url">
</app-pr-input>

<app-save-button class="position_sticky" (clickSave)="onSaveSection()"
    [editable]="this.api.rolesSE.access.canDdit && !this.api.dataControlSE?.currentResult?.status"
>
</app-save-button>