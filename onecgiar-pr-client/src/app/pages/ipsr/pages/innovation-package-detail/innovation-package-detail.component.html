<div class="innovation_packages_title">
  <div style="margin-bottom: 0.5rem">
    <app-phase-switcher></app-phase-switcher>
  </div>

  <div class="title_container">
    @let statusId = this.ipsrDataControlSE?.detailData?.status_id;

    <div class="title">
      <div>
        {{ this.ipsrDataControlSE.detailData?.title }}
      </div>

      @if (
        (this.api.rolesSE.isAdmin || this.api.rolesSE.accessToIPSRSubmit(this.ipsrDataControlSE.initiative_id)) &&
        !this.api.rolesSE.platformIsClosed &&
        (statusId == 1 || statusId == 3)
      ) {
        <div class="submit_button">
          <app-pr-button
            [text]="statusId == 1 ? 'Submit' : 'Un-submission'"
            [verticalMargin]="0"
            [ngClass]="{ globalDisabled: statusId == 3 ? false : !this.ipsrDataControlSE?.detailData?.validResult }"
            (click)="statusId == 1 ? (this.ipsrDataControlSE.modals.submission = true) : (this.ipsrDataControlSE.modals.unsubmit = true)">
          </app-pr-button>
        </div>
      }
    </div>
    <app-pdf-actions (copyEvent)="onCopy()" [horizontal]="true"></app-pdf-actions>
  </div>
</div>

<div class="section_container">
  <app-ipsr-detail-top-menu></app-ipsr-detail-top-menu>
  <div class="ipsr-detail-line"></div>
  <div class="fixed_data_container">
    <div class="back_button">
      <a routerLink="/ipsr/list/innovation-list" class="open_link_in_new_page">
        <app-pr-button text="Back to Innovation Packages list" icon="arrow_back" [reverse]="true" [showBackground]="false"> </app-pr-button>
      </a>
    </div>
    <div class="section_name">{{ this.dataControlSE.currentResultSectionName() }}</div>
    <div class="metadata">
      <div class="item">
        Result code: <span>{{ this.ipsrDataControlSE.detailData?.result_code }}</span>
      </div>
      <div class="item">
        Status: <span>{{ this.api.dataControlSE?.currentResult?.status_name }}</span>
      </div>
      <div class="item">
        Result level: <span>{{ this.ipsrDataControlSE.detailData?.result_level }}</span>
      </div>
      <div class="item">
        Indicator category: <span>{{ this.ipsrDataControlSE.detailData?.result_type }}</span>
      </div>
      <div class="item">
        Submitter:
        <span>{{ this.ipsrDataControlSE.detailData?.official_code }}</span>
      </div>
    </div>
  </div>

  <div class="content">
    @if (this.ipsrDataControlSE.resultInnovationId && this.fieldsManagerSE.porfolioExists()) {
      <router-outlet></router-outlet>
    }
    <div class="spinner" *ngIf="this.saveButtonSE.isGettingSection">
      <div class="info">
        <img src="assets/icons/spinner.png" class="rotating" alt="" srcset="" />
        <div class="text">Loading section...</div>
      </div>
    </div>
    <div class="section_final_space"></div>
  </div>
</div>

<app-partners-request></app-partners-request>
<app-ipsr-unsubmit-modal></app-ipsr-unsubmit-modal>
<app-ipsr-submission-modal></app-ipsr-submission-modal>
<p-toast key="copyResultLinkPdf" position="bottom-center"></p-toast>
