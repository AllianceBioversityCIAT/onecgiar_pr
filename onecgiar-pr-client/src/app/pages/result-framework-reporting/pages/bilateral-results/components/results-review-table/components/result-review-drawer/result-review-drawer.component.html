<p-drawer [(visible)]="visible" [position]="drawerFullScreen() ? 'full' : 'right'" [closable]="false" [style]="{ minWidth: '65vw' }">
  <ng-template #header>
    <div class="result-review-drawer-header">
      <p class="result-review-drawer-header_entity">
        <span class="result-review-drawer-header_entity_acronym">{{ resultToReview()?.acronym }}</span>
        <span class="result-review-drawer-header_separator">|</span>
        <span class="result-review-drawer-header_entity_code">{{ resultToReview()?.project_name }}</span>
      </p>

      <div class="result-review-drawer-header_icons">
        <i
          class="pi {{
            drawerFullScreen() ? 'pi-arrow-down-left-and-arrow-up-right-to-center' : 'pi-arrow-up-right-and-arrow-down-left-from-center'
          }}"
          style="font-size: 15px; cursor: pointer"
          (click)="toggleFullScreen()"></i>
        <i class="pi pi-times" style="font-size: 16px; cursor: pointer" (click)="closeDrawer()"></i>
      </div>
    </div>
  </ng-template>

  <div class="result-review-drawer-content">
    <!-- Result Header Info -->
    <div class="result-review-drawer-content_header">
      <p class="result-review-drawer-content_title">
        {{ resultToReview()?.result_title }}
      </p>

      <div class="result-review-drawer-content_meta">
        <span class="result-review-drawer-content_meta_item">
          <i class="material-icons-round">light_mode</i>
          {{ resultToReview()?.indicator_category }}
        </span>
        <span class="result-review-drawer-content_meta_separator">•</span>
        <span class="result-review-drawer-content_meta_item">
          <i class="material-icons-round">tag</i>
          Result code: {{ resultToReview()?.result_code }}
        </span>
      </div>
    </div>

    <!-- TOC ALIGNMENT Section -->
    <div class="form-section">
      <p class="form-section_title">TOC ALIGNMENT</p>

      <div class="form-field">
        <label class="form-field_label">Does this result align with the Program's TOC?</label>
        <div class="form-field_radio-group">
          <div class="radioButton">
            <p-radioButton name="tocAlignment" [value]="true" [(ngModel)]="tocAlignmentValue" inputId="toc_yes"></p-radioButton>
            <label for="toc_yes" class="form-field_radio-label">Yes</label>
          </div>
          <div class="radioButton">
            <p-radioButton name="tocAlignment" [value]="false" [(ngModel)]="tocAlignmentValue" inputId="toc_no"></p-radioButton>
            <label for="toc_no" class="form-field_radio-label">No</label>
          </div>
        </div>
      </div>

      <div class="form-field">
        <label class="form-field_label">TOC result</label>
        <p-select
          [options]="tocResultOptions"
          [(ngModel)]="selectedTocResult"
          optionLabel="label"
          optionValue="value"
          placeholder="Select TOC result"
          [style]="{ width: '100%' }" />
      </div>

      <div class="form-field">
        <label class="form-field_label">Indicator</label>
        <p-select
          [options]="indicatorOptions"
          [(ngModel)]="selectedIndicator"
          optionLabel="label"
          optionValue="value"
          placeholder="Select indicator"
          [style]="{ width: '100%' }" />
      </div>

      <button pButton class="save-changes-button" (click)="saveTocChanges()">
        <span>Save changes</span>
        <i class="material-icons-round">save</i>
      </button>
    </div>
  </div>

  <!-- Footer Actions -->
  <ng-template #footer>
    <div class="result-review-drawer-footer">
      <button pButton class="approve-button" (click)="onApprove()">
        <i class="pi pi-check"></i>
        <span>APPROVE</span>
      </button>
      <button pButton class="reject-button" (click)="onReject()">
        <i class="pi pi-times"></i>
        <span>REJECT</span>
      </button>
    </div>
  </ng-template>
</p-drawer>

<!-- Confirm Approve Dialog -->
<p-dialog
  appendTo="body"
  [(visible)]="showConfirmApproveDialog"
  [modal]="true"
  [closeOnEscape]="true"
  [showHeader]="false"
  [dismissableMask]="true"
  [draggable]="false"
  [style]="{ padding: '0px' }"
  styleClass="approve-confirmation-modal">
  <div class="modal-header">
    <div class="header-left">
      <div class="success-icon">
        <i class="pi pi-check"></i>
      </div>
      <h2 class="modal-title">APPROVE RESULT – {{ resultToReview()?.result_code }}</h2>
    </div>
    <i class="pi pi-times close-icon" (click)="cancelApprove()"></i>
  </div>
  <div class="modal-content">
    <p class="modal-message">Status will be changed to "Approved", and further changes can be made before the final submission.</p>
  </div>
  <div class="modal-footer">
    <button class="btn-cancel" (click)="cancelApprove()" [disabled]="isSaving()">Cancel</button>
    <button class="btn-confirm" (click)="confirmApprove()" [disabled]="isSaving()">
      <i class="pi pi-spinner pi-spin" *ngIf="isSaving()"></i>
      {{ isSaving() ? 'Approving...' : 'Confirm' }}
    </button>
  </div>
</p-dialog>

<!-- Reject Justification Dialog -->
<p-dialog
  [(visible)]="showConfirmRejectDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '480px' }"
  [draggable]="false"
  [showHeader]="false"
  styleClass="confirm-dialog reject-dialog">
  <div class="confirm-dialog-content">
    <div class="confirm-dialog-icon reject">
      <i class="pi pi-times-circle"></i>
    </div>
    <h3 class="confirm-dialog-title">Reject Result</h3>
    <p class="confirm-dialog-message">
      You are about to reject <strong>{{ resultToReview()?.result_code }}</strong>
    </p>
    <p class="confirm-dialog-subtitle">{{ resultToReview()?.result_title }}</p>

    <div class="confirm-dialog-field">
      <label class="confirm-dialog-label required">Justification</label>
      <textarea
        pInputTextarea
        [(ngModel)]="rejectJustification"
        [rows]="4"
        placeholder="Please explain why this result is being rejected..."></textarea>
      <small class="confirm-dialog-hint">A justification is required to reject this result</small>
    </div>
  </div>

  <div class="confirm-dialog-actions">
    <button pButton class="dialog-cancel-button" (click)="cancelReject()" [disabled]="isSaving()">Cancel</button>
    <button pButton class="dialog-confirm-button reject" [disabled]="!rejectJustification.trim() || isSaving()" (click)="confirmReject()">
      <i class="pi pi-times" *ngIf="!isSaving()"></i>
      <i class="pi pi-spinner pi-spin" *ngIf="isSaving()"></i>
      {{ isSaving() ? 'Rejecting...' : 'Reject Result' }}
    </button>
  </div>
</p-dialog>
