@let unreadNotifications = this.resultsNotificationsSE.updatesPopUpData;

<div class="header_panel" id="sdsdsdsd" *ngIf="!this.dataControlSE.show_qa_full_screen">
  <div class="logo" routerLink="/">
    <img class="cgiar_logo" src="/assets/cgiar_logo.png" alt="" srcset="" />
    <div class="title pr-h4">
      <div class="second-text">{{ this.internationalizationData.global.platformName }}</div>
    </div>
  </div>

  <div class="information">
    <div class="admin_module" *ngIf="this.api?.rolesSE?.isAdmin">
      <a class="admin_module_btn" routerLink="/admin-module/">
        Admin module
        <i class="material-icons-round"> navigate_next </i>
      </a>
    </div>

    <div class="user_tag pr-body-2">
      <i class="material-icons-round icon">account_circle</i>
      <div class="title">{{ this.api.authSE?.localStorageUser?.user_name }}</div>
      <div class="admin_tag" *ngIf="this.api?.rolesSE?.isAdmin">Admin</div>
    </div>

    <div class="my_initiatives" *ngIf="this.api.dataControlSE?.myInitiativesList?.length">
      <div class="title pr-body-2">My roles:</div>
      <div class="items custom_scroll">
        <div class="item pr-body-2" *ngFor="let item of this.api.dataControlSE.myInitiativesList">
          <div class="init">{{ item?.official_code }}</div>
          <div class="role">{{ item?.role }}</div>
        </div>
      </div>
    </div>

    <div [satPopoverAnchor]="popover" (click)="popover.toggle()" class="info_icon">
      @if (unreadNotifications.length === 0) {
        <i class="material-icons-round">notifications</i>
      } @else {
        <p-overlayBadge [value]="notificationBadgeLength()" severity="danger" [style]="{ 'outline-style': 'none' }">
          <i class="material-icons-round animate_bell"> notifications </i>
        </p-overlayBadge>
      }
    </div>

    <app-user-roles-info-modal></app-user-roles-info-modal>

    <div routerLink="/whats-new" pTooltip="What's new?" tooltipPosition="bottom">
      <i class="material-icons-round info_icon">rocket_launch</i>
    </div>

    <div class="logout_btn" (click)="this.api.authSE.logout(); this.api.clearAll(); this.resultsNotificationsSE.resetNotificationInformation()">
      Logout
      <i class="material-icons-round logout_icon">logout</i>
    </div>
  </div>
</div>

<sat-popover
  #popover
  hasBackdrop
  horizontalAlign="center"
  verticalAlign="below"
  scrollStrategy="close"
  [autoFocus]="false"
  (closed)="handleClosePopUp()">
  <div class="overlay_panel">
    <div class="overlay_panel_header">
      <h1 class="m-0 pr-h3">Notifications</h1>
    </div>

    <div class="overlay_panel_separator" [ngStyle]="{ 'margin-bottom': unreadNotifications.length > 0 && '0' }"></div>

    @if (unreadNotifications.length === 0) {
      <p class="no_notifications">
        You have not received any new notifications. Go to the notifications section to see all of your latest notifications.
      </p>
    } @else {
      <div class="notifications_list">
        @for (notification of unreadNotifications; track $index) {
          <app-pop-up-notification-item [notification]="notification" (click)="popover.toggle()"></app-pop-up-notification-item>
        }
      </div>
    }

    <div class="overlay_panel_separator" *ngIf="unreadNotifications.length === 0"></div>

    <div class="overlay_panel_footer" [ngStyle]="{ 'padding-top': unreadNotifications.length > 0 && '15px' }">
      <p class="see_all_notifications" (click)="goToNotifications(); popover.toggle()">See all the notifications</p>
    </div>
  </div>
</sat-popover>

<app-tawk
  *ngIf="this.api.authSE.localStorageUser?.user_name && this.api.authSE.localStorageUser?.email && !inLocal"
  [user]="{ username: this.api.authSE.localStorageUser.user_name, email: this.api.authSE.localStorageUser.email }">
</app-tawk>
